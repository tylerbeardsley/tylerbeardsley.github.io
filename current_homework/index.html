<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <script type = "text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAi1XWg6204cWkmi1cHnD9cqzFd1llj1T0">
    </script>
    <script type="text/javascript">

        var myLat = 0.0;
        var myLng = 0.0;
        var xhr = new XMLHttpRequest();
        var me = new google.maps.LatLng(myLat, myLng);
        var myOptions = {
                zoom: 13,
                center: me,
                mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map;
        var marker;
        var myImage = "41oIHuQ21ML._SS36_.jpg";
        var carmen = "carmen.png";
        var batman = "batman.png";
        var nr = "Norman_Ramsey.png";
        var hescott = "hescott.png";
        var snape = "snape.png";
        var waldo = "waldo.png";
        var infowindow = new google.maps.InfoWindow();
        var places;
        
        function init()
        {
                map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
                getMyLocation();
        }
        
        function getMyLocation()
        {
                if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                                myLat = position.coords.latitude;
                                myLng = position.coords.longitude;
                                renderMap();});
                }
                else {
                        alert("Geolocation is not supported by your web browser.");
                }
        }
        function renderMap()
        {
                me = new google.maps.LatLng(myLat, myLng);
                // Update map and go there...
                map.panTo(me);
                // Create a marker
                marker = new google.maps.Marker({
                position: me,
                title: "WendyTestaburger",
                icon: myImage
                });
                marker.setMap(map);
                // Open info window on click of marker
                google.maps.event.addListener(marker, 'click', function() {
                        infowindow.setContent(marker.title);
                        infowindow.open(map, marker);
                });

                // Send info to herokuapp
                xhr.open("post", "http://chickenofthesea.herokuapp.com/sendLocation", true);
                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhr.onreadystatechange = function() {
                     if (xhr.readyState == 4 && xhr.status == 200){
                           data = xhr.responseText;
                           parsed = JSON.parse(data);
                           //check characters
                           for (i = 0; i < parsed["characters"].length; i++){
                              console.log(parsed["characters"][i]["name"];
                              checkCharacter(parsed["characters"][i]);
                           }
                           // check students 
                           // need to JSON parse through data and then take info to add markers
                     }
                };
                xhr.send("login=WendyTestaburger&lat="+myLat+"&lng="+myLng);

        }
        
        function checkCharacter(character)
        {
                if (character["name"] == "carmen"){
                   createMarker(character, carmen);
                }
                if (character["name"] == "waldo"){
                   createMarker(character, waldo);
                }
                if (character["name"] == "batman"){
                   createMarker(character, batman);
                }
                if (character["name"] == "nr"){
                   createMarker(character, nr);
                }
                if (character["name"] == "snape"){
                   createMarker(character, snape);
                }
                if (character["name"] == "hescott"){
                   createMarker(character, hescott);
                }
        }

        function createMarker(character, image)
        {
                var loc = new google.maps.LatLng(character.loc["latitude"], character.loc["longitude"]);
                var marker = new google.maps.Marker({
                        map: map,
                        position: loc,
                        icon: image
                });
                google.maps.event.addListener(marker, 'click', function() {
                        infowindow.close();
                        infowindow.setContent("Name: " + character.name + "<p> Lat: " + character.loc["latitude"] + "</p> <p> Lng: " + character.loc["longitude"] + "</p> <p> Note: " + character.note + "</p>");
                        infowindow.open(map, this);
                        });
        }
        </script>
      </head>
   <body onload="init()">
      <div id="map_canvas"></div>
   </body>
</html>
